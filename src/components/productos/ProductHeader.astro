---
const { searchPlaceholder = "Buscar productos..." } = Astro.props;
---

<header
  class="sticky top-0 z-50 bg-background-light/80 dark:bg-background-dark/80 backdrop-blur-sm border-b border-border-light dark:border-border-dark"
>
  <div class="container mx-auto px-4">
    <div class="flex h-20 items-center justify-between">
      <div class="flex items-center gap-8">
        <a
          class="flex items-center gap-2 text-text-light dark:text-text-dark"
          href="/"
        >
          <img
            alt="GMExpress Logo"
            class="h-10 w-auto brightness-0 invert dark:brightness-0 dark:invert"
            src="/images/Logo-horizontal.png"
          />
        </a>
        <nav class="hidden md:flex items-center gap-6">
          <a class="text-sm font-medium hover:text-primary" href="/#nosotros"
            >Nosotros</a
          >
          <a class="text-sm font-medium hover:text-primary" href="/servicios"
            >Servicios</a
          >
          <a class="text-sm font-medium hover:text-primary" href="/productos"
            >Productos</a
          >
          <a class="text-sm font-medium hover:text-primary" href="/">Inicio</a>
        </nav>
      </div>
      <div class="flex flex-1 justify-end gap-3 items-center">
        <div class="hidden sm:flex relative max-w-xs w-full">
          <span
            class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-light/60 dark:text-text-dark/60"
            >search</span
          >
          <input
            id="search-input"
            class="w-full rounded-full border border-border-light dark:border-border-dark bg-card-light dark:bg-card-dark h-10 pl-10 pr-4 placeholder:text-text-light/60 dark:placeholder:text-text-dark/60 focus:ring-2 focus:ring-primary focus:border-primary text-sm"
            placeholder={searchPlaceholder}
            type="search"
          />
        </div>
        <button
          data-cart-toggle
          class="flex h-10 w-10 shrink-0 cursor-pointer items-center justify-center overflow-hidden rounded-full bg-card-light dark:bg-card-dark hover:bg-gray-200 dark:hover:bg-gray-700 border border-border-light dark:border-border-dark"
        >
          <span
            class="material-symbols-outlined text-text-light dark:text-text-dark"
            >shopping_cart</span
          >
        </button>
        <button
          class="flex h-10 w-10 shrink-0 cursor-pointer items-center justify-center overflow-hidden rounded-full bg-card-light dark:bg-card-dark hover:bg-gray-200 dark:hover:bg-gray-700 border border-border-light dark:border-border-dark"
        >
          <span
            class="material-symbols-outlined text-text-light dark:text-text-dark"
            >person</span
          >
        </button>
      </div>
    </div>
  </div>
</header>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.getElementById("search-input");

    // FunciÃ³n para normalizar texto (quitar acentos)
    const normalizeText = (text: string): string => {
      return text
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();
    };

    if (searchInput) {
      searchInput.addEventListener("input", (e) => {
        const searchTerm = normalizeText((e.target as HTMLInputElement).value);

        // Buscar tanto productos como servicios
        const productCards = document.querySelectorAll("[data-product]");
        const serviceCards = document.querySelectorAll("[data-service]");
        const allCards = [...productCards, ...serviceCards];

        let visibleCount = 0;

        allCards.forEach((card) => {
          const nameElement = card.querySelector(
            "[data-product-name], [data-service-name]",
          );
          const name = normalizeText(nameElement?.textContent || "");

          if (searchTerm === "" || name.includes(searchTerm)) {
            (card as HTMLElement).style.display = "";
            visibleCount++;
          } else {
            (card as HTMLElement).style.display = "none";
          }
        });

        // Mostrar mensaje si no hay resultados
        let noResultsMsg = document.getElementById("no-results-message");
        const gridContainer = document.querySelector(".grid");

        if (visibleCount === 0 && searchTerm !== "") {
          if (!noResultsMsg && gridContainer) {
            noResultsMsg = document.createElement("div");
            noResultsMsg.id = "no-results-message";
            noResultsMsg.className = "col-span-full text-center py-12";
            noResultsMsg.innerHTML = `
              <span class="material-symbols-outlined text-6xl text-text-light/30 dark:text-text-dark/30">search_off</span>
              <p class="mt-4 text-text-light/60 dark:text-text-dark/60">No se encontraron resultados para "${(e.target as HTMLInputElement).value}"</p>
            `;
            gridContainer.appendChild(noResultsMsg);
          }
        } else if (noResultsMsg) {
          noResultsMsg.remove();
        }
      });
    }
  });
</script>
